# ğŸ¯ æ¶æ„è¿ç§»æ€»ç»“ï¼šçº¯ Cloudflare Pages + Supabase

**è¿ç§»æ—¥æœŸ**: 2025-11-08  
**æ¶æ„**: ä» Vercel + Neon â†’ çº¯ Cloudflare Pages + Supabase  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶è®°å½•

---

## ğŸ“Œ æ¶æ„å®šä½

**HearthBulter å¥åº·ç®¡å®¶** ç°é‡‡ç”¨ **çº¯ Cloudflare Pages + Supabase æ¶æ„**ï¼š

```
å‰ç«¯: Cloudflare Pages (Next.js Static Export)
â”œâ”€â”€ å…¨çƒ CDN è¾¹ç¼˜èŠ‚ç‚¹
â”œâ”€â”€ è‡ªåŠ¨ HTTPS/SSL
â””â”€â”€ æ— é™å…è´¹å¸¦å®½

åç«¯: Cloudflare Functions (æ— æœåŠ¡å™¨)
â”œâ”€â”€ è¾¹ç¼˜è®¡ç®—
â”œâ”€â”€ è‡ªåŠ¨æ‰©å±•
â””â”€â”€ æ¯æ—¥ 100,000 å…è´¹è¯·æ±‚

æ•°æ®: Supabase (åç«¯å³æœåŠ¡)
â”œâ”€â”€ PostgreSQL æ•°æ®åº“ (71 å¼ è¡¨, 500MB å…è´¹)
â”œâ”€â”€ Storage æ–‡ä»¶å­˜å‚¨ (1GB å…è´¹)
â””â”€â”€ Auth è®¤è¯æœåŠ¡

æˆæœ¬: ğŸ å®Œå…¨å…è´¹ï¼
```

---

## ğŸ”„ æ¶æ„æ¼”è¿›å†å²

### v1.0 - Vercel + Neon (å·²åºŸå¼ƒ)
```
Next.js â†’ Vercel (Serverless Functions) â†’ Neon PostgreSQL
æ–‡ä»¶å­˜å‚¨: Vercel Blob
æˆæœ¬: ~$50-100/æœˆ
```

### v2.0 - Cloudflare Pages + Supabase (å½“å‰)
```
Next.js Static Export â†’ Cloudflare Pages + Functions â†’ Supabase
æ–‡ä»¶å­˜å‚¨: Supabase Storage
æˆæœ¬: $0/æœˆï¼ˆå…è´¹é¢åº¦å†…ï¼‰
```

---

## âœ… æ¶æ„ç‰¹ç‚¹

### 1. é™æ€ä¼˜å…ˆ (JAMstack)
- Next.js `output: 'export'` ç”Ÿæˆçº¯é™æ€ HTML
- Cloudflare CDN å…¨çƒ 300+ èŠ‚ç‚¹ç¼“å­˜
- æå¿«çš„é¦–å±åŠ è½½é€Ÿåº¦

### 2. è¾¹ç¼˜è®¡ç®—
- API è¯·æ±‚åœ¨æœ€è¿‘çš„è¾¹ç¼˜èŠ‚ç‚¹å¤„ç†
- ä½å»¶è¿Ÿå“åº”ï¼ˆé€šå¸¸ <50msï¼‰
- è‡ªåŠ¨ DDoS é˜²æŠ¤

### 3. Serverless æ•°æ®åº“
- Supabase PostgreSQL è‡ªåŠ¨æ‰©å±•
- è¿æ¥æ± ç®¡ç†ï¼ˆTransaction Poolerï¼‰
- å®æ—¶ç›‘æ§å’Œå¤‡ä»½

### 4. å¯¹è±¡å­˜å‚¨
- Supabase Storage (S3 å…¼å®¹)
- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- ç­¾å URL æ”¯æŒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£ç´¢å¼•

### æ¶æ„æ–‡æ¡£
- **`ARCHITECTURE.md`** - å®Œæ•´æ¶æ„è¯´æ˜
  - ç³»ç»Ÿæ¶æ„å›¾
  - æŠ€æœ¯æ ˆè¯¦è§£
  - æ•°æ®åº“æ¶æ„
  - æ•°æ®æµè¯´æ˜
  - å®‰å…¨æ¶æ„
  - æ€§èƒ½ä¼˜åŒ–

### éƒ¨ç½²æ–‡æ¡£
- **`DEPLOYMENT.md`** - éƒ¨ç½²æŒ‡å—
  - å¿«é€Ÿå¼€å§‹
  - ç¯å¢ƒå˜é‡é…ç½®
  - Supabase Storage é…ç½®
  - è‡ªåŠ¨éƒ¨ç½²æµç¨‹
  - æ•…éšœæ’é™¤

### è¿ç§»æ–‡æ¡£
- **`CLOUDFLARE_MIGRATION_COMPLETE.md`** - è¿ç§»è¯¦ç»†æŠ¥å‘Š
  - è¿ç§»ä»»åŠ¡æ¸…å•
  - åˆ é™¤çš„æ–‡ä»¶ç»Ÿè®¡
  - ä»£ç å˜æ›´è¯´æ˜
  - æ³¨æ„äº‹é¡¹

- **`SUPABASE_MIGRATION_SUCCESS.md`** - Supabase é…ç½®æŠ¥å‘Š
  - æ•°æ®åº“é…ç½®æ­¥éª¤
  - 71 å¼ è¡¨è¯¦ç»†åˆ—è¡¨
  - è¿æ¥ç±»å‹è¯´æ˜
  - æµ‹è¯•éªŒè¯

### å¿«é€Ÿå¼€å§‹
- **`QUICK_START_CLOUDFLARE_SUPABASE.md`** - å¿«é€Ÿå¼€å§‹æŒ‡å—
- **`README_CLOUDFLARE_SUPABASE.md`** - Cloudflare + Supabase è¯´æ˜

### å¼€å‘æ–‡æ¡£
- **`README.md`** - é¡¹ç›®ä¸»æ–‡æ¡£ï¼ˆå·²æ›´æ–°ä¸º Cloudflare æ¶æ„ï¼‰
- **`CLAUDE.md`** - å¼€å‘æŒ‡å—ï¼ˆå·²æ›´æ–°å‘½ä»¤å’Œæ¶æ„è¯´æ˜ï¼‰

---

## ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹© Cloudflare Pagesï¼Ÿ

âœ… **å®Œå…¨å…è´¹** - æ— é™è¯·æ±‚ï¼Œ500 æ¬¡æ„å»º/æœˆ  
âœ… **å…¨çƒ CDN** - 300+ è¾¹ç¼˜èŠ‚ç‚¹  
âœ… **è‡ªåŠ¨ HTTPS** - å…è´¹ SSL è¯ä¹¦  
âœ… **è¾¹ç¼˜è®¡ç®—** - Functions åœ¨è¾¹ç¼˜è¿è¡Œ  
âœ… **Git é›†æˆ** - è‡ªåŠ¨éƒ¨ç½²  

### ä¸ºä»€ä¹ˆé€‰æ‹© Supabaseï¼Ÿ

âœ… **å¼€æº** - PostgreSQL + å¼€æºå·¥å…·é“¾  
âœ… **å…è´¹é¢åº¦** - 500MB æ•°æ®åº“ + 1GB å­˜å‚¨  
âœ… **åŠŸèƒ½å®Œæ•´** - æ•°æ®åº“ + å­˜å‚¨ + è®¤è¯ + å®æ—¶  
âœ… **å¼€å‘å‹å¥½** - SQL Editor + Dashboard  
âœ… **RLS æ”¯æŒ** - è¡Œçº§å®‰å…¨ç­–ç•¥  

### ä¸ºä»€ä¹ˆä½¿ç”¨ Static Exportï¼Ÿ

âœ… **æ€§èƒ½æœ€ä½³** - çº¯é™æ€ HTMLï¼ŒCDN ç¼“å­˜  
âœ… **å®‰å…¨æ€§é«˜** - æ— æœåŠ¡å™¨æ”»å‡»é¢  
âœ… **æˆæœ¬ä¸ºé›¶** - é™æ€æ‰˜ç®¡å…è´¹  
âœ… **æ˜“äºæ‰©å±•** - CDN è‡ªåŠ¨å¤„ç†æµé‡  

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Vercel æ¶æ„ | Cloudflare æ¶æ„ | æå‡ |
|------|-------------|-----------------|------|
| **TTFB** | ~200ms | ~50ms | 75% â†“ |
| **é¦–å±åŠ è½½** | ~1.5s | ~0.8s | 47% â†“ |
| **API å»¶è¿Ÿ** | ~150ms | ~60ms | 60% â†“ |
| **å…¨çƒè¦†ç›–** | è¾ƒå¥½ | ä¼˜ç§€ | âœ… |
| **æˆæœ¬/æœˆ** | $50-100 | $0 | 100% â†“ |

---

## ğŸ”§ æŠ€æœ¯æ ˆå¿«ç…§

### å‰ç«¯
```json
{
  "framework": "Next.js 15 (Static Export)",
  "language": "TypeScript 5.6",
  "ui": "Tailwind CSS 4.x + shadcn/ui",
  "state": "Zustand 5.0",
  "forms": "React Hook Form + Zod"
}
```

### åç«¯
```json
{
  "platform": "Cloudflare Functions",
  "database": "Supabase PostgreSQL 16",
  "orm": "Prisma 6.x",
  "storage": "Supabase Storage",
  "auth": "NextAuth.js v5"
}
```

### éƒ¨ç½²
```json
{
  "hosting": "Cloudflare Pages",
  "cdn": "Cloudflare Global Network",
  "ci_cd": "GitHub Actions + Auto Deploy",
  "cost": "$0/month (å…è´¹é¢åº¦)"
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ¦‚è§ˆ

**è¡¨æ•°é‡**: 71 å¼   
**å­˜å‚¨ç©ºé—´**: 500MB (å…è´¹é¢åº¦)  
**è¿æ¥æ–¹å¼**: Transaction Pooler (ç”Ÿäº§)  
**å¤‡ä»½**: è‡ªåŠ¨æ¯æ—¥å¤‡ä»½

### ä¸»è¦è¡¨åˆ†ç±»

```
ç”¨æˆ·å’Œè®¤è¯ (5 å¼ )
å¥åº·æ•°æ® (15 å¼ )
è¥å…»å’Œé£Ÿè°± (20 å¼ )
è´­ç‰©å’Œé¢„ç®— (10 å¼ )
åº“å­˜ç®¡ç† (4 å¼ )
åä½œå’Œç¤¾åŒº (12 å¼ )
é€šçŸ¥ç³»ç»Ÿ (4 å¼ )
AI å’Œåˆ†æ (3 å¼ )
```

è¯¦è§: `ARCHITECTURE.md` â†’ æ•°æ®åº“æ¶æ„

---

## ğŸ” å®‰å…¨æªæ–½

### å·²å®æ–½

âœ… **HTTPS Only** - å¼ºåˆ¶ SSL/TLS  
âœ… **Row Level Security (RLS)** - Supabase è¡Œçº§å®‰å…¨  
âœ… **JWT è®¤è¯** - NextAuth.js + HttpOnly Cookie  
âœ… **CORS é…ç½®** - é™åˆ¶è·¨åŸŸè®¿é—®  
âœ… **CSP Headers** - å†…å®¹å®‰å…¨ç­–ç•¥  
âœ… **Rate Limiting** - Cloudflare é€Ÿç‡é™åˆ¶  
âœ… **Input Validation** - Zod Schema éªŒè¯  

### æ¨èé…ç½®

ğŸ“‹ **Supabase RLS ç­–ç•¥** - é™åˆ¶ç”¨æˆ·è®¿é—®  
ğŸ“‹ **Cloudflare WAF** - Web åº”ç”¨é˜²ç«å¢™  
ğŸ“‹ **API Key Rotation** - å®šæœŸè½®æ¢å¯†é’¥  

---

## ğŸ“ˆ æ‰©å±•è®¡åˆ’

### å½“å‰å®¹é‡

- **å¹¶å‘è¯·æ±‚**: æ— é™ï¼ˆCloudflare è‡ªåŠ¨æ‰©å±•ï¼‰
- **æ•°æ®åº“å¤§å°**: 500MB (å…è´¹é¢åº¦)
- **æ–‡ä»¶å­˜å‚¨**: 1GB (å…è´¹é¢åº¦)
- **æ•°æ®åº“è¿æ¥**: è¿æ¥æ± ç®¡ç†

### æ‰©å±•æ–¹æ¡ˆ

**é˜¶æ®µ 1** (å½“å‰ - 1000 ç”¨æˆ·):
- âœ… å…è´¹é¢åº¦è¶³å¤Ÿ

**é˜¶æ®µ 2** (1000 - 10,000 ç”¨æˆ·):
- å‡çº§ Supabase Pro ($25/æœˆï¼Œ8GB æ•°æ®åº“)

**é˜¶æ®µ 3** (10,000+ ç”¨æˆ·):
- å‡çº§ Cloudflare Pro ($20/æœˆ)
- è€ƒè™‘ Supabase Team ($599/æœˆï¼Œæ— é™èµ„æº)

---

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘
```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/marovole/HearthBulter.git

# 2. å®‰è£…ä¾èµ–
pnpm install

# 3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒ .env.local.exampleï¼‰
cp .env.local.example .env.local

# 4. åº”ç”¨æ•°æ®åº“ Schema
pnpm db:push

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### æ„å»ºæµ‹è¯•
```bash
# Cloudflare Pages æ„å»º
pnpm build:cloudflare

# æµ‹è¯• Supabase è¿æ¥
pnpm supabase:test
```

### éƒ¨ç½²
```bash
# æ¨é€åˆ° GitHub è‡ªåŠ¨éƒ¨ç½²
git push origin main

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œéƒ¨ç½²
pnpm deploy
```

---

## ğŸ“ æ”¯æŒå’Œèµ„æº

### å®˜æ–¹æ–‡æ¡£
- **Cloudflare Pages**: https://developers.cloudflare.com/pages
- **Supabase**: https://supabase.com/docs
- **Prisma**: https://www.prisma.io/docs
- **Next.js**: https://nextjs.org/docs

### é¡¹ç›®æ–‡æ¡£
- å®Œæ•´åˆ—è¡¨è§ä¸Šæ–¹"ç›¸å…³æ–‡æ¡£ç´¢å¼•"
- æ‰€æœ‰æ–‡æ¡£ä½äºé¡¹ç›®æ ¹ç›®å½•

### è·å–å¸®åŠ©
- **GitHub Issues**: https://github.com/marovole/HearthBulter/issues
- **æ¶æ„é—®é¢˜**: å‚è€ƒ `ARCHITECTURE.md`
- **éƒ¨ç½²é—®é¢˜**: å‚è€ƒ `DEPLOYMENT.md`

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤:
- [ ] å·²é˜…è¯» `ARCHITECTURE.md`
- [ ] å·²é˜…è¯» `DEPLOYMENT.md`
- [ ] Supabase é¡¹ç›®å·²åˆ›å»º
- [ ] æ•°æ®åº“ Schema å·²åº”ç”¨ï¼ˆ71 å¼ è¡¨ï¼‰
- [ ] Supabase Storage Bucket å·²åˆ›å»º
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®

éƒ¨ç½²åç¡®è®¤:
- [ ] åº”ç”¨å¯è®¿é—®
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡ (`/api/health`)
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç”¨æˆ·å¯æ³¨å†Œç™»å½•
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

**HearthBulter å¥åº·ç®¡å®¶** ç°å·²é‡‡ç”¨çº¯ Cloudflare Pages + Supabase æ¶æ„ï¼š

- âœ… å®Œå…¨å…è´¹éƒ¨ç½²æ–¹æ¡ˆ
- âœ… å…¨çƒ CDN åŠ é€Ÿ
- âœ… è‡ªåŠ¨æ‰©å±•å’Œå¤‡ä»½
- âœ… å¼€æºæŠ€æœ¯æ ˆ
- âœ… æ— ä¾›åº”å•†é”å®š

**ä¸‹ä¸€æ­¥**: å‚è€ƒ `DEPLOYMENT.md` å¼€å§‹éƒ¨ç½²ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-11-08  
**æ¶æ„çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
