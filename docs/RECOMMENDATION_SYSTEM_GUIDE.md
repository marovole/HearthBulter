# 智能食谱推荐系统使用指南

## 概述

智能食谱推荐系统是一个基于多策略融合的个性化推荐引擎，结合了基于规则、协同过滤、内容过滤等多种算法，为用户提供精准的食谱推荐服务。

## 系统架构

### 核心组件

1. **RecommendationEngine** - 主推荐引擎
   - 协调各种推荐策略
   - 合并和排序推荐结果
   - 生成推荐解释

2. **RuleBasedRecommender** - 基于规则的推荐器
   - 季节性推荐
   - 库存匹配推荐
   - 价格偏好推荐
   - 营养目标匹配

3. **CollaborativeFilter** - 协同过滤推荐器
   - 基于用户的协同过滤
   - 基于物品的协同过滤
   - 冷启动问题处理

4. **ContentFilter** - 内容过滤推荐器
   - 食谱特征匹配
   - 用户偏好学习
   - 营养目标对齐

5. **RecommendationRanker** - 推荐排序器
   - 多维度评分
   - 多样性调整
   - 个性化权重

## 数据模型

### 用户行为数据

- **RecipeRating** - 用户评分
- **RecipeFavorite** - 用户收藏
- **RecipeView** - 浏览历史
- **IngredientSubstitution** - 食材替换记录

### 用户偏好数据

- **UserPreference** - 用户偏好设置
  - 饮食类型偏好
  - 口味偏好
  - 成本偏好
  - 营养目标
  - 学习到的偏好

## API 使用

### 获取推荐

```typescript
GET /api/recommendations?memberId=user1&mealType=午餐&servings=2&maxCookTime=60&budgetLimit=50&preferredCuisines=中式&season=春&limit=10
```

**参数说明：**
- `memberId` - 用户ID
- `mealType` - 餐次类型（早餐、午餐、晚餐）
- `servings` - 份数
- `maxCookTime` - 最大烹饪时间（分钟）
- `budgetLimit` - 预算限制
- `dietaryRestrictions` - 饮食限制
- `excludedIngredients` - 排除食材
- `preferredCuisines` - 偏好菜系
- `season` - 季节
- `limit` - 返回数量限制

**响应示例：**
```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "recipeId": "recipe1",
        "score": 85,
        "reasons": ["符合口味", "经济实惠", "营养均衡"],
        "explanation": "这道菜完美匹配您的口味偏好，成本适中，营养搭配合理。",
        "metadata": {
          "inventoryMatch": 0.8,
          "priceMatch": 0.9,
          "nutritionMatch": 0.7,
          "preferenceMatch": 0.85,
          "seasonalMatch": 0.6
        },
        "recipe": {
          "id": "recipe1",
          "name": "番茄炒蛋",
          "totalTime": 20,
          "estimatedCost": 15,
          "calories": 200,
          "ingredients": [...]
        }
      }
    ],
    "context": {...},
    "total": 1
  }
}
```

### 记录用户交互

```typescript
POST /api/recommendations
Content-Type: application/json

{
  "type": "rating",
  "data": {
    "recipeId": "recipe1",
    "memberId": "user1",
    "rating": 5,
    "review": "很好吃！",
    "isRecommended": true
  }
}
```

**支持的交互类型：**
- `rating` - 评分
- `favorite` - 收藏
- `view` - 浏览
- `substitution` - 食材替换

## 推荐策略

### 1. 基于规则的推荐

**评分维度：**
- 库存匹配（0-30分）
- 价格匹配（0-20分）
- 营养匹配（0-30分）
- 偏好匹配（0-15分）
- 季节匹配（0-5分）

**规则示例：**
- 如果用户有减肥目标，优先推荐低卡路里食谱
- 如果用户库存中有某些食材，优先使用这些食材的食谱
- 根据季节推荐当季食材的食谱

### 2. 协同过滤推荐

**用户相似度计算：**
- 基于评分向量的余弦相似度
- 考虑用户行为模式（浏览、收藏、评分）

**物品相似度计算：**
- 基于用户共现的相似度
- 考虑食谱特征相似性

**冷启动处理：**
- 新用户：基于人口统计学和初始偏好
- 新食谱：基于内容特征推荐

### 3. 内容过滤推荐

**特征匹配：**
- 食材匹配度
- 营养相似度
- 烹饪方式匹配
- 菜系和类别匹配
- 价格区间匹配

**学习机制：**
- 从用户行为中学习偏好
- 动态调整用户偏好权重
- 考虑时间衰减因子

### 4. 混合推荐策略

**权重配置：**
```typescript
const weights = {
  inventory: 0.25,    // 库存权重
  price: 0.20,        // 价格权重
  nutrition: 0.25,    // 营养权重
  preference: 0.20,   // 偏好权重
  seasonal: 0.10      // 季节权重
};
```

**融合方法：**
- 加权平均融合
- 级联过滤
- 混合专家模型

## 排序算法

### 多维度评分

1. **基础分数** - 来自各推荐策略的原始分数
2. **受欢迎程度** - 基于评分、评价数、浏览量
3. **新鲜度** - 基于创建时间
4. **个性化分数** - 基于用户历史行为
5. **质量分数** - 基于食谱质量和完整性

### 多样性调整

- **类别多样性** - 避免推荐过多同类食谱
- **菜系多样性** - 平衡不同菜系的推荐
- **标签多样性** - 确保推荐标签的多样性
- **时序多样性** - 避免重复推荐近期内容

## 性能优化

### 缓存策略

1. **用户偏好缓存** - 缓存用户偏好数据
2. **推荐结果缓存** - 缓存推荐结果（短期）
3. **相似度缓存** - 缓存计算出的相似度矩阵
4. **热门食谱缓存** - 缓存热门食谱列表

### 数据库优化

1. **索引优化** - 为查询字段创建适当索引
2. **批量查询** - 减少数据库查询次数
3. **分页加载** - 大数据集分页处理
4. **读写分离** - 推荐查询使用只读副本

### 算法优化

1. **向量化计算** - 使用矩阵运算加速相似度计算
2. **近似算法** - 大数据集使用近似最近邻
3. **增量更新** - 增量更新用户偏好和推荐模型
4. **并行计算** - 多线程并行计算推荐结果

## 扩展性设计

### 微服务架构

- **推荐服务** - 独立的推荐微服务
- **用户服务** - 用户偏好和行为数据
- **内容服务** - 食谱和内容管理
- **分析服务** - 推荐效果分析

### 机器学习集成

- **特征工程** - 自动提取和优化特征
- **模型训练** - 定期训练推荐模型
- **A/B测试** - 测试不同推荐策略
- **在线学习** - 实时更新推荐模型

## 监控和分析

### 关键指标

1. **推荐准确率** - 推荐的点击率、转化率
2. **用户满意度** - 评分、反馈、留存率
3. **系统性能** - 响应时间、吞吐量
4. **业务指标** - 用户活跃度、食谱使用率

### 日志记录

- 推荐请求和响应日志
- 用户交互行为日志
- 系统性能和错误日志
- 模型训练和更新日志

## 最佳实践

### 1. 数据质量

- 确保用户行为数据的准确性
- 定期清理无效数据
- 处理缺失值和异常值
- 数据标准化和归一化

### 2. 推荐解释

- 提供清晰的推荐理由
- 个性化推荐解释
- 透明度设计
- 用户控制选项

### 3. 冷启动问题

- 新用户引导和偏好收集
- 基于内容的初始推荐
- 热门内容推荐
- 快速学习机制

### 4. 用户体验

- 快速响应时间
- 相关性高的推荐
- 多样性保证
- 实时反馈机制

## 故障排除

### 常见问题

1. **推荐结果为空**
   - 检查数据源连接
   - 验证过滤条件
   - 查看日志错误信息

2. **推荐质量差**
   - 检查用户偏好数据
   - 调整推荐权重
   - 验证算法参数

3. **性能问题**
   - 检查数据库查询
   - 优化缓存策略
   - 监控系统资源

### 调试工具

- 推荐结果分析工具
- 用户行为分析工具
- 性能监控面板
- 日志分析系统

## 未来扩展

1. **多模态推荐** - 结合图像、文本等多模态数据
2. **社交推荐** - 融合社交网络信息
3. **情境感知** - 考虑时间、地点、设备等情境因素
4. **跨域推荐** - 跨不同领域的推荐能力
5. **强化学习** - 使用强化学习优化推荐策略
