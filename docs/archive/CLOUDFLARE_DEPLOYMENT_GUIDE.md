# ğŸš€ Cloudflare Pages éƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°† HearthBulter (å¥åº·ç®¡å®¶) åº”ç”¨ä» Vercel è¿ç§»åˆ° Cloudflare Pagesã€‚

## è¿ç§»åŸå› 

- **è§£å†³ Edge Function å¤§å°é™åˆ¶**: ä» 1.05MB ä¼˜åŒ–åˆ° < 500KB
- **é™ä½éƒ¨ç½²æˆæœ¬**: Cloudflare Pages æ›´ä¼˜ï¿½ï¿½ï¿½çš„å®šä»·
- **æå‡å…¨çƒæ€§èƒ½**: åˆ©ç”¨ Cloudflare çš„è¾¹ç¼˜ç½‘ç»œ
- **ç®€åŒ–æ¶æ„**: ç»Ÿä¸€ä¸­é—´ä»¶ï¼Œä¼˜åŒ–ä¾èµ–ç»“æ„

## é¢„è¿ç§»æ£€æŸ¥æ¸…å•

### âœ… å®Œæˆçš„ä¼˜åŒ–å·¥ä½œ

1. **ä¸­é—´ä»¶é‡æ„**
   - âœ… åˆå¹¶æ ¹ç›®å½•å’Œ `src/middleware.ts` æ–‡ä»¶
   - âœ… ç§»é™¤é‡é‡çº§ä¾èµ– (Prisma, bcryptjs, å®‰å…¨å®¡è®¡æ¨¡å—)
   - âœ… åˆ›å»ºè½»é‡çº§è®¤è¯ä¸­é—´ä»¶ (< 250 è¡Œ)
   - âœ… æ·»åŠ å†…ç½®é€Ÿç‡é™åˆ¶å’Œå®‰å…¨å¤´

2. **è®¤è¯æµç¨‹ä¼˜åŒ–**
   - âœ… åˆ›å»º `/api/auth/session` ç«¯ç‚¹
   - âœ… å°†æ•°æ®åº“æŸ¥è¯¢ä» middleware ç§»è‡³ API è·¯ç”±
   - âœ… ä¿æŒ NextAuth é›†æˆ

3. **Cloudflare é€‚é…å™¨**
   - âœ… å®‰è£… `@opennextjs/cloudflare` é€‚é…å™¨
   - âœ… åˆ›å»º `wrangler.toml` é…ç½®æ–‡ä»¶
   - âœ… æ·»åŠ  `build:cloudflare` è„šæœ¬

## Cloudflare Pages éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º Cloudflare Pages é¡¹ç›®

1. **ç™»å½• Cloudflare Dashboard**
   - ï¿½ï¿½é—® https://dash.cloudflare.com/
   - ç™»å½•æ‚¨çš„è´¦æˆ·

2. **åˆ›å»ºæ–° Pages é¡¹ç›®**
   - å·¦ä¾§èœå• â†’ Pages â†’ Create application
   - é€‰æ‹© "Connect to Git"

3. **è¿æ¥ GitHub ä»“åº“**
   - é€‰æ‹© GitHub è´¦æˆ·
   - æœç´¢å¹¶é€‰æ‹© "HearthBulter" ä»“åº“
   - æˆæƒ Cloudflare è®¿é—®ä»“åº“

### æ­¥éª¤ 2: é…æ„å»ºè®¾ç½®

1. **åŸºæœ¬è®¾ç½®**

   ```
   Framework preset: Next.js
   Build command: npm run build:cloudflare
   Build output directory: .vercel/output/static
   Root directory: /
   ```

2. **Node.js ç‰ˆæœ¬**
   - è®¾ç½® Node.js ç‰ˆæœ¬: `20.x`
   - åŒ…ç®¡ç†å™¨: `npm`

### æ­¥éª¤ 3: ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Cloudflare Pages é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

#### å¿…éœ€çš„ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“è¿æ¥
DATABASE_URL="postgresql://neondb_owner:npg_PoBYp7z0fOjC@ep-snowy-silence-ad5majbd-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require"

# NextAuth é…ç½®
NEXTAUTH_SECRET="U97nNxOcByJp3BS5IIf+FGbxv5PWRBXd0WFF8YHTRxk="
NEXTAUTH_URL="https://your-app.pages.dev"

# CORS é…ç½®
NEXT_PUBLIC_ALLOWED_ORIGINS="https://your-app.pages.dev"

# ç¯å¢ƒè®¾ç½®
NODE_ENV="production"
```

#### å¯é€‰çš„ç¯å¢ƒå˜é‡

```bash
# Google OAuth (å¦‚æœä½¿ç”¨)
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# å…¶ä»–æœåŠ¡é…ç½®
```

### æ­¥éª¤ 4: éƒ¨ç½²é…ç½®

1. **é¦–æ¬¡éƒ¨ç½²**
   - ç‚¹å‡» "Save and Deploy"
   - ç­‰å¾…æ„å»ºå®Œæˆ (çº¦ 3-5 åˆ†é’Ÿ)

2. **æ„å»ºè®¾ç½®ä¼˜åŒ–**
   ```bash
   # Cloudflare æ„å»ºå‘½ä»¤
   npm run build:cloudflare
   ```

### æ­¥éª¤ 5: åŸŸåé…ç½®

1. **ä½¿ç”¨ Cloudflare åŸŸå**
   - é»˜è®¤: `your-app.pages.dev`
   - å¯é…ç½®è‡ªå®šä¹‰åŸŸå

2. **è®¾ç½®è‡ªå®šä¹‰åŸŸå**
   - Pages é¡¹ç›® â†’ Custom domains
   - æ·»åŠ æ‚¨çš„åŸŸå
   - é…ç½® DNS è®°å½•

## éªŒè¯éƒ¨ç½²

### åŠŸèƒ½æ£€æŸ¥æ¸…å•

- [ ] **ä¸»é¡µåŠ è½½**: è®¿é—®é¦–é¡µæ­£å¸¸æ˜¾ç¤º
- [ ] **ç”¨æˆ·æ³¨å†Œ**: æ–°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] **ç”¨æˆ·ç™»å½•**: ç°æœ‰ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] **ä»ªè¡¨ç›˜**: ç™»å½•åèƒ½è®¿é—®ä»ªè¡¨ç›˜
- [ ] **API ç«¯ç‚¹**: æ‰€æœ‰ API è·¯ç”±å“åº”æ­£å¸¸
- [ ] **æ•°æ®åº“æ“ä½œ**: æ•°æ®è¯»å†™åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½æµ‹è¯•

1. **é¡µé¢åŠ è½½é€Ÿåº¦**
   - é¦–é¡µ: < 2 ç§’
   - ä»ªè¡¨ç›˜: < 3 ç§’

2. **API å“åº”æ—¶é—´**
   - è®¤è¯ç«¯ç‚¹: < 500ms
   - æ•°æ®ç«¯ç‚¹: < 1 ç§’

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ„å»ºå¤±è´¥

**é—®é¢˜**: æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

```bash
Error: Build failed
```

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ Node.js ç‰ˆæœ¬ (éœ€è¦ 20.x)
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯

#### 2. ä¸­é—´ä»¶é”™è¯¯

**é—®é¢˜**: é¡µé¢æ˜¾ç¤ºä¸­é—´ä»¶é”™è¯¯

```bash
Error: Middleware execution failed
```

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ `middleware.ts` æ–‡ä»¶è¯­æ³•
- éªŒè¯ NextAuth é…ç½®
- æŸ¥çœ‹è¾¹ç¼˜å‡½æ•°æ—¥å¿—

#### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: æ— æ³•è¿æ¥åˆ° Neon æ•°æ®åº“

```bash
Error: Database connection failed
```

**è§£å†³æ–¹æ¡ˆ**:

- éªŒè¯ `DATABASE_URL` ç¯å¢ƒå˜é‡
- æ£€æŸ¥ Neon é¡¹ç›®çŠ¶æ€
- ç¡®è®¤ IP ç™½åå•è®¾ç½®

#### 4. è®¤è¯é—®é¢˜

**é—®é¢˜**: ç”¨æˆ·æ— æ³•ç™»å½•æˆ– session å¤±æ•ˆ

```bash
Error: Authentication failed
```

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ `NEXTAUTH_SECRET` é…ç½®
- éªŒè¯ `NEXTAUTH_URL` è®¾ç½®
- æ£€æŸ¥å›è°ƒ URL é…ç½®

### è°ƒè¯•å·¥å…·

1. **Cloudflare Logs**
   - Dashboard â†’ Pages â†’ æ‚¨çš„é¡¹ç›® â†’ Logs
   - å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—

2. **æœ¬åœ°æµ‹è¯•**
   ```bash
   # æœ¬åœ°è¿è¡Œ Cloudflare ç‰ˆæœ¬
   npm run build:cloudflare
   npx wrangler pages dev .vercel/output/static
   ```

## æ€§èƒ½ä¼˜åŒ–

### å·²å®æ–½çš„ä¼˜åŒ–

1. **ä¸­é—´ä»¶ä¼˜åŒ–**
   - å¤§å°ä» 1.05MB å‡å°‘åˆ° ~250 è¡Œä»£ç 
   - ç§»é™¤é‡é‡çº§ä¾èµ–
   - ä½¿ç”¨å†…ç½®é€Ÿç‡é™åˆ¶

2. **å›¾ç‰‡ä¼˜åŒ–**
   - é…ç½® Next.js Image ä¼˜åŒ–
   - æ”¯æŒ WebP/AVIF æ ¼å¼

3. **ç¼“å­˜ç­–ç•¥**
   - é™æ€èµ„æºç¼“å­˜
   - API å“åº”ç¼“å­˜

### è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨ Cloudflare ç¼“å­˜**
   - é…ç½®é¡µé¢è§„åˆ™
   - è®¾ç½®ç¼“å­˜ TTL

2. **ä½¿ç”¨ Cloudflare KV**
   - å­˜å‚¨ä¼šè¯æ•°æ®
   - ç¼“å­˜å¸¸ç”¨æ•°æ®

## æˆæœ¬å¯¹æ¯”

### Vercel (Hobby Plan)

- **è´¹ç”¨**: $0/æœˆ
- **é™åˆ¶**: Edge Function 1MB
- **é—®é¢˜**: ä¸­é—´ä»¶å¤§å°è¶…é™

### Cloudflare Pages (Free Plan)

- **è´¹ç”¨**: $0/æœˆ
- **ä¼˜åŠ¿**: æ—  Edge Function å¤§å°é™åˆ¶
- **åŒ…å«**: 500 æ¬¡æ„å»º/æœˆï¼Œ20,000 è¯·æ±‚/å¤©

### Cloudflare Pages (Pro Plan)

- **è´¹ç”¨**: $20/æœˆ
- **ä¼˜åŠ¿**: æ— é™æ„å»ºï¼Œ100 ä¸‡è¯·æ±‚/å¤©
- **é€‚ç”¨**: ç”Ÿäº§ç¯å¢ƒ

## å›æ»šè®¡åˆ’

å¦‚æœ Cloudflare éƒ¨ç½²å‡ºç°é—®é¢˜ï¼š

1. **ä¿ç•™ Vercel é…ç½®**
   - Vercel é¡¹ç›®ä¿æŒä¸å˜
   - ä»£ç å·²å¤‡ä»½åœ¨ GitHub

2. **å¿«é€Ÿå›æ»šæ­¥éª¤**
   - ä¿®æ”¹ DNS æŒ‡å‘ Vercel
   - é‡æ–°éƒ¨ç½²åˆ° Vercel
   - éªŒè¯åŠŸèƒ½æ­£å¸¸

3. **é—®é¢˜ä¿®å¤åé‡æ–°éƒ¨ç½²**
   - ä¿®å¤ Cloudflare é…ç½®é—®é¢˜
   - é‡æ–°æ‰§è¡Œéƒ¨ç½²æµç¨‹
   - åˆ‡æ¢å› Cloudflare

## åç»­ç»´æŠ¤

### å®šæœŸä»»åŠ¡

1. **ç›‘æ§æ€§èƒ½**
   - æ£€æŸ¥é¡µé¢åŠ è½½é€Ÿåº¦
   - ç›‘æ§ API å“åº”æ—¶é—´
   - æŸ¥çœ‹é”™è¯¯ç‡

2. **æ›´æ–°ä¾èµ–**
   - å®šæœŸæ›´æ–° Next.js ç‰ˆæœ¬
   - æ›´æ–° Cloudflare é€‚é…å™¨
   - æ£€æŸ¥å®‰å…¨æ›´æ–°

3. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - ä¿æŒä»£ç åŒæ­¥
   - æ–‡æ¡£æ›´æ–°

## æ”¯æŒèµ„æº

- **Cloudflare Pages æ–‡æ¡£**: https://developers.cloudflare.com/pages/
- **OpenNext æ–‡æ¡£**: https://opennext.js.org/cloudflare
- **Next.js æ–‡æ¡£**: https://nextjs.org/docs
- **é—®é¢˜åé¦ˆ**: GitHub Issues

---

**åˆ›å»ºæ—¶é—´**: 2025-11-04
**ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤è€…**: HearthBulter å¼€å‘å›¢é˜Ÿ
