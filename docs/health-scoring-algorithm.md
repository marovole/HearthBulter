# 健康评分算法说明

## 概述

健康评分系统是一个综合评估用户健康状况的算法，通过分析营养摄入、运动情况、睡眠质量和体检数据四个维度，计算出一个0-100分的综合健康评分。

## 评分体系结构

### 1. 综合评分计算

综合健康评分采用加权平均的方式计算：

```
综合评分 = 营养评分 × 40% + 运动评分 × 30% + 睡眠评分 × 20% + 体检评分 × 10%
```

### 2. 分项评分权重

| 维度 | 权重 | 说明 |
|------|------|------|
| 营养评分 | 40% | 基于每日营养目标达成情况 |
| 运动评分 | 30% | 基于每日运动时长 |
| 睡眠评分 | 20% | 基于睡眠时长和质量 |
| 体检评分 | 10% | 基于生理指标检测 |

## 分项评分详解

### 营养评分 (0-100分)

#### 计算方法
1. 获取用户当天的营养目标和实际摄入量
2. 计算各营养素的实际/目标比值
3. 根据比值区间计算单项评分
4. 取四大营养素（卡路里、蛋白质、碳水化合物、脂肪）的平均分

#### 评分标准

| 实际/目标比值 | 评分 | 说明 |
|---------------|------|------|
| 90% - 110% | 100 | 完美达成 |
| 80% - 90% 或 110% - 120% | 90 | 略有偏差 |
| 70% - 80% 或 120% - 130% | 75 | 明显偏差 |
| 60% - 70% 或 130% - 150% | 60 | 较大偏差 |
| < 60% 或 > 150% | 40 | 严重偏差 |

#### 示例
- 目标卡路里2000kcal，实际1800kcal（比值90%）→ 100分
- 目标蛋白质60g，实际45g（比值75%）→ 75分

### 运动评分 (0-100分)

#### 计算方法
基于每日运动时长，参考WHO建议的每周150分钟中等强度运动标准（约22分钟/天）。

#### 评分标准

| 运动时长 | 评分 | 说明 |
|----------|------|------|
| ≥ 30分钟 | 100 | 超出建议标准 |
| 22 - 30分钟 | 90 | 达到WHO建议 |
| 15 - 22分钟 | 75 | 接近建议标准 |
| 10 - 15分钟 | 60 | 有运动但不足 |
| 0 - 10分钟 | 40 | 运动量很少 |
| 0分钟 | 0 | 没有运动 |

### 睡眠评分 (0-100分)

#### 计算方法
基于睡眠时长，结合睡眠质量进行调整。

#### 基础评分标准

| 睡眠时长 | 基础评分 | 说明 |
|----------|----------|------|
| 7 - 9小时 | 100 | 最佳睡眠时长 |
| 6 - 7小时 或 9 - 10小时 | 85 | 略有偏差但可接受 |
| 5 - 6小时 或 10 - 11小时 | 65 | 睡眠不足或过多 |
| < 5小时 或 > 11小时 | 40 | 严重睡眠问题 |

#### 睡眠质量加成

| 睡眠质量 | 加分 | 说明 |
|----------|------|------|
| 优秀 | +10 | 睡眠质量很好 |
| 良好 | +5 | 睡眠质量较好 |
| 一般 | 0 | 睡眠质量一般 |
| 较差 | -10 | 睡眠质量较差 |

**注意**：质量加成后分数限制在0-100分范围内。

### 体检评分 (0-100分)

#### 计算方法
基于最近30天内的体检数据，检查各项生理指标是否在正常范围内。初始分数100分，异常指标按程度扣分。

#### 检查指标及扣分标准

**血压（收缩压/舒张压）**
- 正常：90-120 / 60-80 mmHg → 不扣分
- 略高：收缩压120-130 mmHg → 扣10分
- 异常：收缩压>130或<90 mmHg → 扣20分

**心率**
- 正常：60-100 bpm → 不扣分
- 略异常：50-60或100-110 bpm → 扣10分
- 异常：<50或>110 bpm → 扣20分

**BMI**
- 正常：18.5-24 → 不扣分
- 偏瘦/偏胖：17-18.5或24-28 → 扣10分
- 过瘦/过胖：<17或>28 → 扣20分

**体脂率**
- 男性正常：10-20%，女性正常：18-28% → 不扣分
- 男性略异常：8-10%或20-25%，女性略异常：15-18%或28-33% → 扣10分
- 男性异常：<8%或>25%，女性异常：<15%或>33% → 扣20分

## 数据完整性处理

### 数据缺失处理
- 如果某个维度没有数据，该维度评分为0，但会影响综合评分
- 数据完整性 = 有数据的维度数 / 4
- 最终评分会考虑数据完整性因素

### 数据时效性
- 营养、运动、睡眠数据：使用当天数据
- 体检数据：使用最近30天内的数据

## 评级标准

根据综合评分，将健康状况分为4个等级：

| 评分范围 | 等级 | 说明 |
|----------|------|------|
| 90-100分 | 优秀 | 健康状况很好 |
| 75-89分 | 良好 | 健康状况较好 |
| 60-74分 | 一般 | 健康状况一般 |
| 0-59分 | 较差 | 需要改善健康状况 |

## 个性化建议

系统会根据各分项评分生成个性化建议：

### 营养建议
- 评分<70分时，分析具体营养素偏差
- 提供饮食结构调整建议

### 运动建议
- 评分<70分时，建议增加运动量
- 推荐每周150分钟中等强度运动

### 睡眠建议
- 评分<70分时，建议改善睡眠习惯
- 推荐保持规律作息，7-9小时睡眠

### 综合建议
- 建议定期记录健康数据
- 异常情况及时咨询医生

## 算法特点

1. **科学性**：基于WHO建议和医学标准
2. **全面性**：涵盖营养、运动、睡眠、体检四个维度
3. **个性化**：考虑个人目标和身体状况
4. **实用性**：评分标准清晰，易于理解和改进
5. **灵活性**：支持权重调整和评分标准优化

## 使用示例

```typescript
// 计算某用户某天的健康评分
const result = await calculateHealthScore('user-id', new Date());

// 结果示例
{
  overallScore: 82.5,      // 综合评分
  components: {
    nutritionScore: 85,     // 营养评分
    exerciseScore: 90,      // 运动评分
    sleepScore: 75,         // 睡眠评分
    medicalScore: 80        // 体检评分
  },
  grade: 'GOOD',           // 评级：良好
  dataCompleteness: 1.0,   // 数据完整性：100%
  recommendations: [       // 个性化建议
    '建议改善睡眠质量，保持规律作息',
    '定期记录健康数据，帮助系统提供更准确的分析'
  ]
}
```

## 注意事项

1. 评分结果仅供参考，不能替代专业医疗建议
2. 建议结合医生指导进行健康管理
3. 评分算法会根据用户反馈和医学研究持续优化
4. 孕妇、儿童、老年人等特殊人群可能需要调整评分标准
