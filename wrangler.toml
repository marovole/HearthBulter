# Cloudflare Pages + Supabase 混合架构配置文件
# 适配 Next.js 15 静态导出 + Supabase 后端

pages_build_output_dir = ".open-next"

name = "hearthbutler-supabase"

# 兼容性设置 - 启用 Node.js 兼容性
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat", "nodejs_als"]

# 生产环境配置
[env.production]
name = "hearthbutler-supabase-prod"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat", "nodejs_als"]

# 生产环境 KV
[[env.production.kv_namespaces]]
binding = "CACHE_KV"
id = "dd47f27d131a466db34838dd247df983"

# Preview 环境配置（替换 staging 和 development）
[env.preview]
name = "hearthbutler-supabase-preview"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat", "nodejs_als"]

# 预览环境 KV
[[env.preview.kv_namespaces]]
binding = "CACHE_KV"
id = "3416fc31333f449194c9e8e3c00fafec"

# 环境变量配置
[vars]
NODE_ENV = "production"
NEXTAUTH_URL = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_ALLOWED_ORIGINS = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_SITE_URL = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_SUPABASE_URL = "https://ppmliptjvzurewsiwswb.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwbWxpcHRqdnp1cmV3c2l3c3diIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1ODQ0MzEsImV4cCI6MjA3ODE2MDQzMX0.r1_kuC6ekX1u1omuxjdf4c7ZQ_e70ciqwKGGqK6mkP0"
UPSTASH_REDIS_REST_URL = "https://teaching-eagle-34132.upstash.io"

# 生产环境变量
[env.production.vars]
NODE_ENV = "production"
NEXTAUTH_URL = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_ALLOWED_ORIGINS = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_SITE_URL = "https://hearthbulter.pages.dev"
NEXT_PUBLIC_SUPABASE_URL = "https://ppmliptjvzurewsiwswb.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwbWxpcHRqdnp1cmV3c2l3c3diIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1ODQ0MzEsImV4cCI6MjA3ODE2MDQzMX0.r1_kuC6ekX1u1omuxjdf4c7ZQ_e70ciqwKGGqK6mkP0"
UPSTASH_REDIS_REST_URL = "https://teaching-eagle-34132.upstash.io"

# Preview 环境变量
[env.preview.vars]
NODE_ENV = "preview"
NEXTAUTH_URL = "https://preview.hearthbulter.pages.dev"
NEXT_PUBLIC_ALLOWED_ORIGINS = "https://preview.hearthbulter.pages.dev"
NEXT_PUBLIC_SITE_URL = "https://preview.hearthbulter.pages.dev"
NEXT_PUBLIC_SUPABASE_URL = "https://ppmliptjvzurewsiwswb.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwbWxpcHRqdnp1cmV3c2l3c3diIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1ODQ0MzEsImV4cCI6MjA3ODE2MDQzMX0.r1_kuC6ekX1u1omuxjdf4c7ZQ_e70ciqwKGGqK6mkP0"
UPSTASH_REDIS_REST_URL = "https://teaching-eagle-34132.upstash.io"

# KV 存储配置已移至各环境配置中
# 生产环境: env.production.kv_namespaces
# 预览环境: env.preview.kv_namespaces

# D1 数据库 (如果需要)
# [[d1_databases]]
# binding = "DB"
# database_name = "hearthbutler-db"
# database_id = "your-database-id"

# R2 存储 (如果需要)
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "hearthbutler-assets"

# ============================================
# Health Butler vNext - Cron Triggers 配置
# ============================================
# 每日任务生成: 每天 08:00 UTC (北京时间 16:00)
# 每日复盘生成: 每天 20:00 UTC (北京时间次日 04:00)
#
# 注意: Cloudflare Pages Functions 的 Cron Triggers 配置
# 需要在 Cloudflare Dashboard 中手动设置，或在部署时通过 wrangler.toml 传递
#
# Cron 表达式格式: 分 时 日 月 周
# 示例:
# - "0 8 * * *" = 每天 08:00
# - "0 20 * * *" = 每天 20:00
# - "0 */6 * * *" = 每 6 小时
#
# 设置方式:
# 1. Cloudflare Dashboard: Pages > Settings > Functions > Cron Triggers
# 2. 添加以下两条规则:
#    - cron/generate-tasks: "0 8 * * *"
#    - cron/generate-daily-reviews: "0 20 * * *"
#
# 手动测试 (开发环境):
# curl -X GET "https://your-domain/api/cron/generate-tasks?secret=YOUR_CRON_SECRET"
# curl -X GET "https://your-domain/api/cron/generate-daily-reviews?secret=YOUR_CRON_SECRET"
# ============================================