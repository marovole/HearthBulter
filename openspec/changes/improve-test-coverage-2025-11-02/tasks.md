## 1. 修复 Jest 测试环境配置

- [ ] 1.1 更新 Jest 配置文件
  - [ ] 修复 `jest.config.js` 配置问题
  - [ ] 配置正确的测试环境 (node/jsdom)
  - [ ] 设置模块路径映射
  - [ ] 配置转换忽略模式

- [ ] 1.2 创建测试设置文件
  - [ ] 创建 `jest.setup.js` 文件
  - [ ] 配置全局测试环境
  - [ ] 设置测试超时时间
  - [ ] 配置 mock 默认值

- [ ] 1.3 修复环境变量配置
  - [ ] 为测试环境配置必要的环境变量
  - [ ] Mock 外部 API 密钥
  - [ ] 配置测试数据库连接

## 2. 解决 Prisma Client 测试问题

- [ ] 2.1 配置 Prisma 测试环境
  - [ ] 设置测试数据库
  - [ ] 配置 Prisma Client 在测试环境中的使用
  - [ ] 创建数据库清理机制

- [ ] 2.2 实现 Prisma Mock 策略
  - [ ] 创建 Prisma Mock 工厂
  - [ ] Mock 数据库查询操作
  - [ ] 提供测试数据生成工具

- [ ] 2.3 数据库测试工具
  - [ ] 实现测试数据库迁移
  - [ ] 创建测试种子数据
  - [ ] 配置数据库隔离策略

## 3. 修复模块依赖和 Mock 问题

- [ ] 3.1 解决 Request 对象未定义问题
  - [ ] 配置 Next.js Request 对象的 mock
  - [ ] 创建 API 测试工具函数
  - [ ] 实现 Next.js 中间件测试

- [ ] 3.2 修复模块路径解析
  - [ ] 配置 Jest 模块路径映射
  - [ ] 解决 `@/` 路径别名问题
  - [ ] 修复相对路径导入问题

- [ ] 3.3 Mock 外部依赖
  - [ ] Mock NextAuth.js
  - [ ] Mock 外部 API 调用 (OpenAI, USDA 等)
  - [ ] Mock 文件上传和 OCR 服务

## 4. 增加单元测试覆盖

- [ ] 4.1 业务逻辑服务测试
  - [ ] 测试营养计算服务
  - [ ] 测试食谱生成服务
  - [ ] 测试预算跟踪服务
  - [ ] 测试通知服务

- [ ] 4.2 工具函数测试
  - [ ] 测试验证函数
  - [ ] 测试格式化函数
  - [ ] 测试计算函数
  - [ ] 测试数据处理函数

- [ ] 4.3 React 组件测试
  - [ ] 测试 UI 组件渲染
  - [ ] 测试用户交互
  - [ ] 测试表单验证
  - [ ] 测试状态管理

## 5. 实现集成测试

- [ ] 5.1 API 端点集成测试
  - [ ] 测试认证相关 API
  - [ ] 测试用户管理 API
  - [ ] 测试健康数据 API
  - [ ] 测试营养规划 API

- [ ] 5.2 数据库集成测试
  - [ ] 测试数据模型关系
  - [ ] 测试复杂查询操作
  - [ ] 测试数据一致性
  - [ ] 测试并发操作

## 6. 添加端到端测试

- [ ] 6.1 设置 Playwright 环境
  - [ ] 配置 Playwright 测试框架
  - [ ] 设置测试浏览器环境
  - [ ] 配置测试数据管理

- [ ] 6.2 关键用户流程测试
  - [ ] 测试用户注册和登录流程
  - [ ] 测试健康数据录入流程
  - [ ] 测试营养规划流程
  - [ ] 测试报告生成流程

## 7. 测试覆盖率优化

- [ ] 7.1 提升覆盖率到 70%
  - [ ] 分析当前覆盖率报告
  - [ ] 识别未覆盖的代码路径
  - [ ] 添加缺失的测试用例

- [ ] 7.2 配置覆盖率报告
  - [ ] 设置覆盖率阈值
  - [ ] 配置覆盖率报告格式
  - [ ] 集成到 CI/CD 流程

- [ ] 7.3 持续监控和维护
  - [ ] 建立测试覆盖率监控
  - [ ] 设置覆盖率回归检测
  - [ ] 定期审查和优化测试策略